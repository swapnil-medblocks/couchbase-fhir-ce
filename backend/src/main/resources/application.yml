spring:
  application:
    name: backend
  config:
    import: classpath:fhir.yml

# Basic Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      show-components: always

# Container-specific configuration
---
spring:
  config:
    activate:
      on-profile: prod

# Suppress error details and stack traces in production/container environments
server:
  error:
    include-stacktrace: never
    include-message: on-param
    include-binding-errors: never
    include-exception: false
  tomcat:
    accesslog:
      enabled: false
    threads:
      max: ${SERVER_TOMCAT_THREADS_MAX:50} # Override with env var (default 50 for low memory)
      min-spare: ${SERVER_TOMCAT_THREADS_MIN_SPARE:10} # Minimum idle threads
    accept-count: ${SERVER_TOMCAT_ACCEPT_COUNT:100} # Queue size when all threads busy
    max-connections: ${SERVER_TOMCAT_MAX_CONNECTIONS:200} # Max simultaneous connections
    connection-timeout: ${SERVER_TOMCAT_CONNECTION_TIMEOUT:20s}
    max-keep-alive-requests: ${SERVER_TOMCAT_MAX_KEEP_ALIVE_REQUESTS:1000}

# Logging configuration for containers
logging:
  level:
    "[ca.uhn.fhir.rest.server.RestfulServer]": OFF
    "[org.apache.catalina]": WARN
    "[org.apache.catalina.connector]": OFF
    "[org.springframework.security]": WARN
    "[org.springframework.web.servlet]": WARN
    "[com.couchbase.transactions]": ERROR
  pattern:
    console: "%d{HH:mm:ss.SSS} %-5level %logger{20} - %msg%n"
